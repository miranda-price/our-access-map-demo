<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.8.0/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.8.0/leaflet.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <style>
      #map {position: absolute; top: 0; right: 0; bottom: 0; left: 0;}
    </style>
  </head>
  <body>
    <div id="map">
    </div>
    <form id="route-input" style="position:fixed; top: 90px; left: 10px; z-index: 999;">
      <label for="start-building" class="form-label">Starting</label>
      <input class="form-control" list="datalistOptions" id="start-building" placeholder="Starting building..." onchange="propogateFloors('start-building', 'start-floor')">
      <datalist id="datalistOptions">
        <option value="Bausch & Lomb"></option>
        <option value="Burton"></option>
        <option value="Dewey"></option>
        <option value="Hoyt"></option>
        <option value="Lattimore"></option>
        <option value="Morey"></option>
        <option value="Rettner"></option>
        <option value="Rush Rhees"></option>
      </datalist>
      <label for="start-floor" class="form-label">Floor</label>
      <select class="form-select" aria-label="Select starting floor" id="start-floor" name="start-floor">
        <option selected>--</option>
      </select>
      <label for="end-building" class="form-label">Destination</label>
      <input class="form-control" list="datalistOptions" id="end-building" placeholder="Destination..." onchange="propogateFloors('end-building', 'end-floor')">
      <datalist id="datalistOptions">
        <option value="Bausch & Lomb"></option>
        <option value="Burton"></option>
        <option value="Dewey"></option>
        <option value="Hoyt"></option>
        <option value="Lattimore"></option>
        <option value="Morey"></option>
        <option value="Rettner"></option>
        <option value="Rush Rhees"></option>
      </datalist>
      <label for="end-floor" class="form-label">Floor</label>
      <select class="form-select" aria-label="Select ending floor" id="end-floor" name="end-floor">
        <option selected>--</option>
      </select>
      <button type="submit">Find Route</button>      
    </form>

    <script>  
    var map = L.map('map').setView([43.1279308, -77.6299522], 22);
    var userLoc = L.circleMarker([43.1279308, -77.6299522]).addTo(map);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

     // propogate floor select options
     function floorOptions(selectID, floors, main) {
      var floorSelect = document.getElementById(selectID);
      floorSelect.innerHTML = '';
      for (let i = 0; i < floors.length; i++) {
        var opt = document.createElement("option");
        opt.text = floors[i];
        opt.value = floors[i];
        if (floors[i] == main) {
          opt.selected = true;
        }
        floorSelect.appendChild(opt);
      }
    }

    function propogateFloors(selectBuilding, selectFloor) {
      building = document.getElementById(selectBuilding).value;
      switch (building) {
        case 'Burton':
          floorOptions(selectFloor, ['0', '1', '2', '3'], '1');
          break;
        case 'Rettner':
          floorOptions(selectFloor, ['1', '2', '3'], '1');
          break;
        case 'Lattimore':
          floorOptions(selectFloor, ['1', '2', '3', '4', '5'], '3');
          break;
        case 'Morey':
          floorOptions(selectFloor, ['1', '2', '3', '4', '5'], '3');
          break;
        case 'Rush Rhees':
          floorOptions(selectFloor, ['G', '1', '2', '3', '4'], '1');
          break;
        case 'Hoyt':
          floorOptions(selectFloor, ['1', '2'], '1');
          break;
        case 'Bausch & Lomb':
          floorOptions(selectFloor, ['1', '2', '3', '4', '5'], '2');
          break;
        case 'Dewey':
          floorOptions(selectFloor, ['B', '1', '2', '3', '4', '5'], '2');
          break;
        default:
          floorOptions(selectFloor, ['B', 'G', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10'], '1');
      }
    }

    // propogate floors again on refresh
    if (document.getElementById('start-building').value != "") {propogateFloors('start-building', 'start-floor');}
    if (document.getElementById('end-building').value != "") {propogateFloors('end-building', 'end-floor');}

    // find user location
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var userLat = position.coords.latitude;
        var userLng = position.coords.longitude;
        map.flyTo([userLat, userLng], 18);
        userLoc.setLatLng([userLat, userLng]);
        // find building
        var startBuilding = document.getElementById('start-building');
        if (userLat >= 43.1291045 && userLng >= -77.6315905 && userLat <= 43.1294653 && userLng <= -77.6310999) {
          startBuilding.value = "Burton";
        } else if (userLat >= 43.1283453 && userLng >= -77.6301887 && userLat <= 43.1287222 && userLng <= -77.6299084) {
          startBuilding.value = "Rettner";
        } else if (userLat >= 43.1278795 && userLng >= -77.6310298 && userLat <= 43.1284557 && userLng <= -77.6303584) {
          startBuilding.value = "Lattimore";
        } else if (userLat >= 43.1282511 && userLng >= -77.6300449 && userLat <= 43.1286226 && userLng <= -77.6293624) {
          startBuilding.value = "Morey";
        } else if (userLat >= 43.1280746 && userLng >= -77.6289956 && userLat <= 43.1289271 && userLng <= -77.6279555) {
          startBuilding.value = "Rush Rhees";
        } else if (userLat >= 43.1271754 && userLng >= -77.6296437 && userLat <= 43.1275899 && userLng <= -77.6294596) {
          startBuilding.value = "Hoyt";
        }  else if (userLat >= 43.1271345 && userLng >= -77.6293156 && userLat <= 43.1279928 && userLng <= -77.6289476) {
          startBuilding.value = "Bausch & Lomb";
        } else if (userLat >= 43.1267433 && userLng >= -77.6302677 && userLat <= 43.1276542 && userLng <= -77.6297637) {
          startBuilding.value = "Dewey";
        } 
        else {
          startBuilding.value = "";
        }

        if (startBuilding.value != "") {propogateFloors('start-building', 'start-floor')}
      })
    } else {
      map.flyTo([43.1279308, -77.6299522], 18);
    }

    // update user location
    function updateLoc() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          userLoc.setLatLng([position.coords.latitude, position.coords.longitude]);
        })
      }
    }
    setInterval(updateLoc, 100)

    function toFeet(meters) {
      return meters * 3.28084
    }
      
     // define custom icon classes
    var benchIcon = L.icon({
      iconUrl: 'icons/map-icons-bench.svg',
      iconSize:     [24, 24],
      iconAnchor:   [12, 12]
    });
    var rampIcon = L.icon({
      iconUrl: 'icons/map-icons_ramp.svg',
      iconSize:     [24, 24],
      iconAnchor:   [12, 12]
    });
    var ElevatorNotWCIcon = L.icon({
      iconUrl: 'icons/map-icons_elevator-wc-inaccessible.svg',
      iconSize:     [24, 24],
      iconAnchor:   [12, 12]
    });
    var ElevatorWCIcon = L.icon({
      iconUrl: 'icons/map-icons_elevator-wc-accessible.svg',
      iconSize:     [24, 24],
      iconAnchor:   [12, 12]
    });
    var ElevatorNotWCBrokenIcon = L.icon({
      iconUrl: 'icons/map-icons_elevator-wc-inaccessible-broken.svg',
      iconSize:     [24, 24],
      iconAnchor:   [12, 12]
    });
    var ElevatorWCBrokenIcon = L.icon({
      iconUrl: 'icons/map-icons_elevator-wc-accessible-broken.svg',
      iconSize:     [24, 24],
      iconAnchor:   [12, 12]
    });
    var stairsIcon = L.icon({
      iconUrl: 'icons/map-icons_stairs.svg',
      iconSize:     [24, 24],
      iconAnchor:   [12, 12]
    });
    var stepsIcon = L.icon({
      iconUrl: 'icons/map-icons_steps.svg',
      iconSize:     [24, 24],
      iconAnchor:   [12, 12]
    });

    // accessibility feature/obstacle icon layers
    var elevatorsWC = L.layerGroup([
      L.marker([43.1276125, -77.6291051], {icon: ElevatorWCIcon}),
      L.marker([43.1274355, -77.6299342], {icon: ElevatorWCIcon}),
      L.marker([43.1287886,	-77.6283118], {icon: ElevatorWCIcon}),
      L.marker([43.1285332,	-77.6287911], {icon: ElevatorWCIcon}),
      L.marker([43.1283968,	-77.629964], {icon: ElevatorWCIcon}),
    ])

    var elevatorsNotWC = L.layerGroup([
      L.marker([43.1268674,	-77.6298621], {icon: ElevatorNotWCIcon}),
      L.marker([43.1280796,	-77.6307938], {icon: ElevatorNotWCIcon}),
      L.marker([43.128426,	-77.6282768], {icon: ElevatorNotWCIcon}),
      L.marker([43.1285562,	-77.6284588], {icon: ElevatorNotWCIcon}),
    ])
    
    var stairs = L.layerGroup([
      L.marker([43.1275485,	-77.6297659], {icon: stairsIcon}),
      L.marker([43.1275985,	-77.629621], {icon: stairsIcon}),
      L.marker([43.1282961,	-77.6298432], {icon: stairsIcon}),
      L.marker([43.1283492,	-77.6296488], {icon: stairsIcon}),
      L.marker([43.1282856,	-77.629008], {icon: stairsIcon}),
      L.marker([43.1275883,	-77.6311369], {icon: stairsIcon}),
      L.marker([43.1275439,	-77.6310123], {icon: stairsIcon}),
      L.marker([43.1274337,	-77.6310388], {icon: stairsIcon}),
      L.marker([43.1279407,	-77.6312298], {icon: stairsIcon}),
      L.marker([43.1287609,	-77.6289171], {icon: stairsIcon}),
      L.marker([43.1285883,	-77.6291013], {icon: stairsIcon}),
      L.marker([43.128738,	-77.6290179], {icon: stairsIcon}),
      L.marker([43.1276688,	-77.6294263], {icon: stairsIcon}),
      L.marker([43.1278215,	-77.629013], {icon: stairsIcon}),
      L.marker([43.1273017,	-77.6290454], {icon: stairsIcon}),
      L.marker([43.1293054,	-77.631355], {icon: stairsIcon}),
      L.marker([43.1292582,	-77.6314721], {icon: stairsIcon}),
      L.marker([43.12934,	-77.631243], {icon: stairsIcon}),
      L.marker([43.1269542,	-77.6298441], {icon: stairsIcon}),
      L.marker([43.1271962,	-77.6299666], {icon: stairsIcon}),
      L.marker([43.1274355,	-77.6300423], {icon: stairsIcon}),
      L.marker([43.1273277,	-77.6302874], {icon: stairsIcon}),
      L.marker([43.1274329,	-77.6295342], {icon: stairsIcon}),
      L.marker([43.1274118,	-77.6296135], {icon: stairsIcon}),
      L.marker([43.1283633,	-77.6308529], {icon: stairsIcon}),
      L.marker([43.1281519,	-77.630689], {icon: stairsIcon}),
      L.marker([43.1284164,	-77.6298514], {icon: stairsIcon}),
      L.marker([43.1285104,	-77.6296046], {icon: stairsIcon}),
      L.marker([43.1286647,	-77.6300753], {icon: stairsIcon}),
      L.marker([43.1285523,	-77.6301978], {icon: stairsIcon}),
      L.marker([43.1284771,	-77.6284728], {icon: stairsIcon}),
      L.marker([43.1283877,	-77.6283713], {icon: stairsIcon}),
      L.marker([43.1285358,	-77.6283328], {icon: stairsIcon}),
      L.marker([43.1285179,	-77.627899], {icon: stairsIcon}),
      L.marker([43.1283698,	-77.6289871], {icon: stairsIcon}),
      L.marker([43.1283162,	-77.6286512], {icon: stairsIcon}),
      L.marker([43.1284745,	-77.6287526], {icon: stairsIcon}),
    ]);

    var steps = L.layerGroup([
      L.marker([43.1278898,	-77.629309], {icon: stepsIcon}),
      L.marker([43.1292073,	-77.6314372], {icon: stepsIcon}),
      L.marker([43.1292527,	-77.6313251], {icon: stepsIcon}),
      L.marker([43.1292927,	-77.6312056], {icon: stepsIcon}),
      L.marker([43.1275354,	-77.6302513], {icon: stepsIcon}),
      L.marker([43.127437,	-77.6297163], {icon: stepsIcon}),
      L.marker([43.1275113,	-77.6295178], {icon: stepsIcon}),
      L.marker([43.1280086,	-77.6305709], {icon: stepsIcon}),
      L.marker([43.1284373,	-77.6294587], {icon: stepsIcon}),
    ]);

    var ramps = L.layerGroup([
      L.marker([43.1278946,	-77.6292573], {icon: rampIcon}),
      L.marker([43.1275275,	-77.6302802], {icon: rampIcon}),
      L.marker([43.1280017,	-77.6305957], {icon: rampIcon}),
      L.marker([43.1284461,	-77.6294503], {icon: rampIcon}),
      L.marker([43.1285883,	-77.6290144], {icon: rampIcon}),
    ]);

    var benches = L.layerGroup([
      L.marker([43.1282528,	-77.6300452], {icon: benchIcon}),
      L.marker([43.1281894,	-77.6302399], {icon: benchIcon}),
      L.marker([43.1286943,	-77.6287485], {icon: benchIcon}),
      L.marker([43.1279306,	-77.6299444], {icon: benchIcon}),
      L.marker([43.1288705,	-77.6290047], {icon: benchIcon}),
      L.marker([43.1276439,	-77.6298366], {icon: benchIcon}),
      L.marker([43.1276896,	-77.6296767], {icon: benchIcon}),
      L.marker([43.1283067,	-77.6297827], {icon: benchIcon}),
      L.marker([43.1284767,	-77.6291222], {icon: benchIcon}),
      L.marker([43.128124,	-77.6288823], {icon: benchIcon}),
      L.marker([43.1274054,	-77.6307613], {icon: benchIcon}),
      L.marker([43.1277758,	-77.6310082], {icon: benchIcon}),
      L.marker([43.1289136,	-77.6291993], {icon: benchIcon}),
      L.marker([43.129076,	-77.6293036], {icon: benchIcon}),
    ]);

    var overlayMaps = {
      "WC Accessible Elevators": elevatorsWC.addTo(map),
      "WC Inaccessible Elevators": elevatorsNotWC.addTo(map),
      "Ramps": ramps.addTo(map),
      "Stairs": stairs.addTo(map),
      "Steps": steps.addTo(map),
      "Benches": benches.addTo(map)
    };

    var layerControl = L.control.layers(null, overlayMaps, {collapsed: false}).addTo(map);
   
    </script>
  </body>
</html>
